<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gold Portfolio</title>

  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#111111">

  <style>
    body{
      font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      margin:24px;
      background:#f7f7f7
    }
    .card{
      background:#fff;
      border:1px solid #e5e5e5;
      border-radius:14px;
      padding:16px;
      max-width:680px;
      box-shadow:0 2px 10px rgba(0,0,0,.04)
    }
    h1{font-size:20px;margin:0 0 12px}
    label{display:block;font-size:13px;margin-top:12px;color:#333}
    input{
      width:100%;
      padding:12px;
      font-size:16px;
      border:1px solid #d8d8d8;
      border-radius:10px
    }
    button{
      margin-top:14px;
      width:100%;
      padding:12px;
      font-size:16px;
      border:0;
      border-radius:10px;
      background:#111;
      color:#fff;
      cursor:pointer
    }
    button:disabled{opacity:.6}
    .row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:6px 0;
      align-items:center
    }
    .out{
      margin-top:14px;
      padding:12px;
      background:#eef7ff;
      border:1px solid #cfe7ff;
      border-radius:10px
    }
    .muted{color:#666;font-size:12px;margin-top:10px}
    .err{color:#b00020;font-size:13px;margin-top:10px}
    .tag{
      font-size:12px;
      border:1px solid #ddd;
      border-radius:999px;
      padding:2px 8px;
      background:#fafafa
    }
  </style>
</head>

<body>
<div class="card">
  <h1>Gold-Portfolio</h1>

  <label for="ounces">Anzahl Unzen (troy oz)</label>
  <input id="ounces" inputmode="decimal" placeholder="z. B. 1, 7 oder 12,5" />

  <button id="refresh">Aktualisieren</button>
  <div id="error" class="err"></div>

  <div class="out" id="output" style="display:none;">
    <div class="row">
      <div>Unzen</div>
      <div><strong id="ozUsed">â€“</strong></div>
    </div>
    <div class="row">
      <div>Goldpreis (PrimÃ¤r)</div>
      <div><strong id="pPrimary">â€“</strong> <span class="tag">XAUEUR</span></div>
    </div>
    <div class="row">
      <div>Goldpreis (Check)</div>
      <div><strong id="pCheck">â€“</strong> <span class="tag">XAUUSD + ECB</span></div>
    </div>
    <div class="row">
      <div>Portfolio-Wert</div>
      <div><strong id="portfolio">â€“</strong></div>
    </div>
    <div class="row">
      <div class="muted">Stand</div>
      <div class="muted" id="asOf">â€“</div>
    </div>
  </div>

  <div class="muted">
    Daten: Stooq Â· Check: XAU/USD + EZB FX
  </div>
</div>

<script>
(() => {
  const $ = id => document.getElementById(id);

  const btn = $("refresh");
  const err = $("error");
  const out = $("output");

  const ozUsedEl = $("ozUsed");
  const pPrimaryEl = $("pPrimary");
  const pCheckEl = $("pCheck");
  const portfolioEl = $("portfolio");
  const asOfEl = $("asOf");

  function parseNumber(v){
    if(!v) return null;
    const n = Number(String(v).replace(",", "."));
    return Number.isFinite(n) ? n : null;
  }

  function fmtEUR(n){
    return new Intl.NumberFormat("de-DE", {
      style: "currency",
      currency: "EUR"
    }).format(n);
  }

  async function fetchPrice(){
    const url = new URL("data/price.json", window.location.href);
    url.searchParams.set("v", Date.now()); // cache busting
    const r = await fetch(url.toString(), { cache: "no-store" });
    if(!r.ok) throw new Error("price.json nicht erreichbar");
    return r.json();
  }

  async function refresh(){
    err.textContent = "";
    btn.disabled = true;
    btn.textContent = "Ladeâ€¦";

    try {
      const data = await fetchPrice();

      const primary = data.primary?.eurPerOz;
      const check = data.check?.eurPerOz;

      if(!Number.isFinite(primary)){
        throw new Error("UngÃ¼ltiger PrimÃ¤rpreis");
      }

      const ounces = parseNumber($("ounces").value);

      pPrimaryEl.textContent = fmtEUR(primary) + " / oz";
      pCheckEl.textContent = Number.isFinite(check)
        ? fmtEUR(check) + " / oz"
        : "â€“";

      asOfEl.textContent = data.asOf || "â€“";

      if(ounces && ounces > 0){
        ozUsedEl.textContent = ounces.toString().replace(".", ",");
        portfolioEl.textContent = fmtEUR(primary * ounces);
      } else {
        ozUsedEl.textContent = "â€“";
        portfolioEl.textContent = "â€“";
      }

      out.style.display = "block";
    } catch(e){
      err.textContent = "Fehler: " + (e.message || "unbekannt");
      out.style.display = "none";
    } finally {
      btn.disabled = false;
      btn.textContent = "Aktualisieren";
    }
  }

  btn.addEventListener("click", refresh);

  // ðŸ”¥ wichtig: sofort laden
  refresh();
})();
</script>
</body>
</html>
